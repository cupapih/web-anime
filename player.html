<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>BStationX - Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="storage.js"></script>

<style>
    body{margin:0;background:#000;color:white;font-family:Arial, sans-serif}
    .top{padding:15px;background:#111;display:flex;justify-content:space-between;align-items:center}
    .back{color:#ec4899;cursor:pointer;text-decoration:none;font-weight:bold}
    
    /* Video Wrapper */
    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    
    .container{padding:20px; max-width: 1000px; margin: auto;}
    .anime-info { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
    .title{font-size:24px; color:#ec4899; margin: 0 0 10px 0;}
    .genre { color: #aaa; font-size: 14px; margin-bottom: 10px; }
    .synopsis { font-size: 15px; color: #ccc; line-height: 1.6; background: #111; padding: 15px; border-radius: 8px; }

    .controls{margin: 20px 0; display: flex; gap: 10px; align-items: center;}
    .btn-nav { padding:10px 20px; background:#333; border:none; color:white; border-radius:6px; cursor:pointer; font-weight: bold;}
    .btn-nav:hover { background: #444; }
    .btn-download { padding:10px 20px; background:#ec4899; border:none; color:white; border-radius:6px; cursor:pointer; font-weight: bold; text-decoration: none; display: inline-block;}
    
    .episodes-label { font-weight: bold; margin-bottom: 10px; display: block; }
    .episodes{display:grid;grid-template-columns:repeat(auto-fill, minmax(60px, 1fr));gap:10px}
    .ep{ background:#18181b; padding:12px; text-align:center; cursor:pointer; border-radius:4px; border: 1px solid #333; }
    .ep.active{background:#ec4899; border-color: #ec4899;}
</style>
</head>
<body>

<div class="top">
    <a class="back" href="index.html">‚Üê Kembali ke Beranda</a>
    <div id="animeInfoSmall" style="font-size: 12px; color: #888;"></div>
</div>

<div class="video-wrapper">
    <iframe id="videoPlayer" src="" allowfullscreen></iframe>
</div>

<div class="container">
    <div class="anime-info">
        <h2 class="title" id="title"></h2>
        <div class="genre" id="genres"></div>
        <div class="synopsis" id="synopsis"></div>
    </div>

    <div class="controls">
        <button class="btn-nav" onclick="prevEp()">‚óÄ Prev</button>
        <button class="btn-nav" onclick="nextEp()">Next ‚ñ∂</button>
        <a id="downloadBtn" class="btn-download" target="_blank">üì• Download Video</a>
    </div>

    <span class="episodes-label">Daftar Episode:</span>
    <div class="episodes" id="epList"></div>
</div>

<script>
const params = new URLSearchParams(location.search);
const animeId = params.get('id'); // ID adalah index array di database
let epNum = parseInt(params.get('ep')) || 1;

const db = getDB();
const anime = db[animeId];

if(!anime) {
    alert("Anime tidak ditemukan!");
    location.href = 'index.html';
}

// Elemen UI
const player = document.getElementById('videoPlayer');
const downloadBtn = document.getElementById('downloadBtn');

// Tampilkan Data Anime
document.getElementById('title').innerText = anime.title;
document.getElementById('genres').innerText = "Genre: " + (anime.genres ? anime.genres.join(", ") : "-");
document.getElementById('synopsis').innerHTML = anime.description || "Tidak ada sinopsis.";

function playEpisode(n){
    // Cari data episode
    const episode = anime.episodes.find(e => e.number == n) || anime.episodes[0];
    if(!episode) return;

    epNum = n;
    document.title = `Nonton ${anime.title} - Episode ${n}`;
    
    // Set Video & Download Link
    player.src = episode.video;
    downloadBtn.href = episode.video; // Link download diarahkan ke source video

    renderEpisodes();
}

function renderEpisodes(){
    const epList = document.getElementById('epList');
    epList.innerHTML='';
    anime.episodes.forEach(e => {
        const div = document.createElement('div');
        div.className = `ep ${e.number == epNum ? 'active' : ''}`;
        div.innerText = e.number;
        div.onclick = () => playEpisode(e.number);
        epList.appendChild(div);
    });
}

function nextEp(){ if(epNum < anime.episodes.length) playEpisode(epNum + 1); }
function prevEp(){ if(epNum > 1) playEpisode(epNum - 1); }

// Jalankan saat load
playEpisode(epNum);
</script>

</body>
</html>