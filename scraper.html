<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>BStationX - Auto Sync Sub Indo</title>
<script src="storage.js"></script>

<style>
body{
  background:#000;color:#fff;font-family:sans-serif;
  display:flex;justify-content:center;align-items:center;
  height:100vh;margin:0
}
.sync-card{
  text-align:center;background:#111;padding:40px;
  border-radius:20px;border:2px solid #ec4899;width:420px
}
.loader{
  width:40px;height:40px;border:4px solid #333;
  border-top:4px solid #ec4899;border-radius:50%;
  animation:spin 1s linear infinite;margin:20px auto
}
@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}
#log{
  font-size:12px;color:#aaa;margin-top:15px;
  height:80px;overflow-y:auto;text-align:left
}
</style>
</head>

<body>

<div class="sync-card">
  <div style="font-weight:bold;color:#ec4899;font-size:1.2rem">
    100 ANIME SUB INDO SYNC
  </div>
  <div class="loader"></div>
  <div id="status">Mengambil data ongoing...</div>
  <div id="log">Memulai sinkronisasi...</div>
</div>

<script>
async function startSync() {
  const log = document.getElementById("log");
  const status = document.getElementById("status");

  try {
    clearDB();
    let totalGrabbed = 0;

    // 5 halaman x ±20 anime = ±100
    for (let page = 1; page <= 5; page++) {
      status.innerText = `Mengambil halaman ${page}...`;

      const res = await fetch(`/api/ongoing?page=${page}`);
      if (!res.ok) throw new Error("API error");

      const data = await res.json();
      const list = data?.animeList || [];

      for (const item of list) {
        if (totalGrabbed >= 100) break;

        const slug = item.id;
        const episodes = [];

        // Generate episode 1–24
        for (let i = 1; i <= 24; i++) {
          episodes.push({
            number: i,
            video: `https://shironime.com/embed/${slug}-episode-${i}`
          });
        }

        addAnime({
          title: item.title,
          cover: item.thumb,
          description: `Nonton ${item.title} Subtitle Indonesia. Update episode terbaru.`,
          genres: ["Ongoing", "Sub Indo"],
          status: "Currently Airing",
          episodes
        });

        totalGrabbed++;
        log.innerHTML =
          `✔ ${item.title}<br>` + log.innerHTML;
      }
    }

    status.innerText = "Sinkronisasi Selesai ✔";
    setTimeout(() => {
      window.location.href = "index.html";
    }, 2000);

  } catch (e) {
    status.innerText = "Gagal Sinkronisasi ❌";
    log.innerText = "Error: " + e.message;
  }
}

window.onload = startSync;
</script>

</body>
</html>
