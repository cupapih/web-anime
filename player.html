<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>BStationX - Watch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="storage.js"></script>

<style>
    body{margin:0;background:#000;color:white;font-family:Arial, sans-serif}
    .top{padding:15px;background:#111;display:flex;justify-content:space-between;align-items:center}
    .back{color:#ec4899;cursor:pointer;text-decoration:none;font-weight:bold}
    
    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
    /* SANDBOX ditambahkan agar iklan Hidoristream tidak tembus */
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    
    .container{padding:20px; max-width: 1000px; margin: auto;}
    .anime-info { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
    .title{font-size:24px; color:#ec4899; margin: 0 0 10px 0;}
    .genre { color: #aaa; font-size: 14px; margin-bottom: 10px; }
    .synopsis { font-size: 15px; color: #ccc; line-height: 1.6; background: #111; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;}

    .controls{margin: 20px 0; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;}
    .btn-nav { padding:10px 20px; background:#333; border:none; color:white; border-radius:6px; cursor:pointer; font-weight: bold;}
    .btn-download { padding:10px 20px; background:#22c55e; border:none; color:white; border-radius:6px; cursor:pointer; font-weight: bold; text-decoration: none; display: inline-block;}
    
    .episodes-label { font-weight: bold; margin-bottom: 10px; display: block; color: #ec4899;}
    .episodes{display:grid;grid-template-columns:repeat(auto-fill, minmax(60px, 1fr));gap:10px}
    .ep{ background:#18181b; padding:12px; text-align:center; cursor:pointer; border-radius:4px; border: 1px solid #333; }
    .ep.active{background:#ec4899; border-color: #ec4899; font-weight: bold;}
</style>
</head>
<body>

<div class="top">
    <a class="back" href="index.html">‚Üê Kembali ke Beranda</a>
    <div id="statusTag" style="font-size: 12px; padding: 4px 8px; background: #ec4899; border-radius: 4px; font-weight: bold;">ONGOING</div>
</div>

<div class="video-wrapper">
    <iframe id="videoPlayer" src="" allowfullscreen sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation"></iframe>
</div>

<div class="container">
    <div class="anime-info">
        <h2 class="title" id="title">Memuat...</h2>
        <div class="genre" id="genres">Genre: Sub Indo</div>
        <div class="synopsis" id="synopsis"></div>
    </div>

    <div class="controls">
        <button class="btn-nav" onclick="prevEp()">‚óÄ Prev</button>
        <button class="btn-nav" onclick="nextEp()">Next ‚ñ∂</button>
        <a id="downloadBtn" class="btn-download" target="_blank">üì• Download Video</a>
    </div>

    <span class="episodes-label">Pilih Episode:</span>
    <div class="episodes" id="epList"></div>
</div>

<script>
const params = new URLSearchParams(location.search);
const animeId = params.get('id'); 
let epNum = parseInt(params.get('ep')) || 1;

const db = getDB();
const anime = db[animeId];

if(!anime) {
    location.href = 'index.html';
}

const player = document.getElementById('videoPlayer');
const downloadBtn = document.getElementById('downloadBtn');

document.getElementById('title').innerText = anime.title;
document.getElementById('synopsis').innerText = anime.description;

function playEpisode(n){
    const episode = anime.episodes.find(e => e.number == n);
    if(!episode) return;

    epNum = n;
    document.title = `Nonton ${anime.title} Episode ${n}`;
    
    // Link video v1.hidoristream masuk ke iframe
    player.src = episode.video;
    downloadBtn.href = episode.video; 

    renderEpisodes();
    if(window.innerWidth < 768) window.scrollTo({top: 0, behavior: 'smooth'});
}

function renderEpisodes(){
    const epList = document.getElementById('epList');
    epList.innerHTML='';
    anime.episodes.forEach(e => {
        const div = document.createElement('div');
        div.className = `ep ${e.number == epNum ? 'active' : ''}`;
        div.innerText = e.number;
        div.onclick = () => playEpisode(e.number);
        epList.appendChild(div);
    });
}

function nextEp(){ if(epNum < anime.episodes.length) playEpisode(epNum + 1); }
function prevEp(){ if(epNum > 1) playEpisode(epNum - 1); }

playEpisode(epNum);
</script>
</body>
</html>