<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Hidoristream Scraper</title>
    <script src="storage.js" defer></script>
    <style>
        body{background:#0f0f0f;color:white;font-family:Arial;padding:24px}
        button{padding:12px;background:#00b4d8;border:none;color:white;cursor:pointer;font-weight:bold;border-radius:4px}
        button:disabled{background:#555;cursor:not-allowed}
        pre{background:black;padding:12px;margin-top:12px;white-space: pre-wrap;word-wrap: break-word;border: 1px solid #333;font-size:12px;color: #adff2f}
    </style>
</head>
<body>

    <h2>Hidoristream Auto Sync</h2>
    <p>Mengambil anime terbaru langsung dengan link video yang bisa diputar.</p>
    <button id="runBtn">SYNC SEKARANG</button>
    <pre id="log">Status: Menunggu...</pre>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const log = document.getElementById('log');
        const runBtn = document.getElementById('runBtn');
        let isRunning = false;

        runBtn.addEventListener('click', async () => {
            if(isRunning) return;
            if (typeof addAnime !== 'function') return alert("storage.js belum siap!");

            isRunning = true;
            runBtn.disabled = true;
            log.textContent = 'Memulai proses scraping dari Hidoristream...\n';
            
            // Opsional: Hapus data lama agar tidak double
            if(confirm("Hapus data lama?")) clearDB();

            try {
                // Mengambil data dari API Hidoristream (Endpoint Anime Terbaru)
                const response = await fetch('https://v1.hidoristream.online/api/anime/terbaru');
                const result = await response.json();

                // Asumsi struktur data Hidoristream adalah result.data atau result
                const listAnime = result.data || result;

                listAnime.forEach((item, index) => {
                    // Mapping data dari Hidoristream ke format database kamu
                    addAnime({
                        title: item.title,
                        cover: item.poster || item.thumbnail,
                        status: item.status || "Ongoing",
                        episodes: [
                            {
                                title: "Episode " + (item.last_episode || "1"),
                                // Mengambil link video langsung dari API mereka
                                url: item.video_url || `https://v1.hidoristream.online/embed/${item.slug}`
                            }
                        ]
                    });
                    log.textContent += `[OK] Berhasil menarik: ${item.title}\n`;
                });

                log.textContent += '\nâœ“ SELESAI! Video sekarang sesuai dengan Hidoristream.';
            } catch (err) {
                log.textContent += '\n[ERROR] Gagal mengambil data: ' + err.message;
                console.error(err);
            } finally {
                isRunning = false;
                runBtn.disabled = false;
            }
        });
    });
    </script>
</body>
</html>